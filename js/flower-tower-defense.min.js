/*! flower-tower-defense 2022-07-09 */
(function(){var a;a||(a={log:function(){}})}).call(this),function(){Crafty.c("Actor",{init:function(){return this.requires("2D, Canvas, Grid")}})}.call(this),function(){Crafty.c("ActualFPS",function(){var a,b,c;return c=void 0,b=void 0,a=void 0,{init:function(){c=(new Date).getTime(),b=0,this.bind("ExitFrame",function(){var d;d=(new Date).getTime(),d-c>=1e3?(a=b,b=0,c=d):b++})},FPS:function(){return a}}}())}.call(this),function(){Crafty.c("Bullet",{init:function(){return this.requires("Actor, Collision, PathWalker"),this.attr({damage:1})}})}.call(this),function(){Crafty.c("Button",{init:function(){this.requires("2D, Text, Mouse, Tooltip"),this.overrideTextColorFunction(),this._highlightColor=Game.highlightColor,this.textFont(Game.generalButtonFont),this.enable(),Crafty.mobile&&this.bind("MouseUp",function(a){this._previousMouseUp?this.trigger("Click",a):this._previousMouseUp=!0})},overrideTextColorFunction:function(){this._previousColors=[],this._previousTextColor=this.textColor,this.textColor=function(a){return this._previousTextColor.call(this,a),this._previousColors.unshift(a),this._previousColors.length>5&&this._previousColors.pop(),this}},mouseOverHandler:function(){this._previousTextColor.call(this,this._highlightColor)},mouseOutHandler:function(){this.textColor(this._previousColors[0]),this._previousMouseUp=!1},enable:function(){return this.textColor(Game.textColor),this.bind("MouseOver",this.mouseOverHandler),this.bind("MouseOut",this.mouseOutHandler),this.attr({buttonEnabled:!0}),this},disable:function(){return this.unbind("MouseOver",this.mouseOverHandler),this.unbind("MouseOut",this.mouseOutHandler),this.textColor(Game.disabledColor),this.attr({buttonEnabled:!1}),this},highlightColor:function(a){return this._highlightColor=a,this},withImage:function(a){var b;return b=Crafty.e("2D, Image, "+(this.has("Canvas")?"Canvas":"DOM")),b.image(a).attr({x:this.x,y:this.y}),this.attach(b),this},withSprite:function(a){return this.addComponent(a),this}})}.call(this),function(){Crafty.c("DOMButton",{init:function(){var a;this.requires("Button, DOM"),this.css(Game.buttonCss),a=this.text,this.text=function(b){return void 0===b||null===b?this._text:(a.call(this,b),this._element.innerHTML=this._text,this)},this.enable=function(){return this.attr({buttonEnabled:!0}),this.removeComponent("disabledButton"),this},this.disable=function(){return this.attr({buttonEnabled:!1}),this.addComponent("disabledButton"),this}}})}.call(this),function(){Crafty.c("Enemy",{init:function(){var a;this.requires("Actor, Collision, PathWalker, Delay, Tooltip"),this.attr({tooltipWidth:150,tooltipHeight:30}),Game.enemyCount++,this.checkHits("Bullet"),this.bind("HitOn",function(a){this.hitWithDamage(a[0].obj.damage),a[0].obj.destroy()}),a=this,this.delay(function(){a.tooltip((a.tooltipTextBase?a.tooltipTextBase+" with ":"")+this.health+" HP")},100,-1),this.bind("TweenEnded",function(b){a===b&&(Game.lifes-=this.livesTaken||1,this.kill(!1),Crafty.audio.play("LifeLost",1))})},hitWithDamage:function(a){this.health<=0||(this.attr({health:this.health-a}),this.health<=0&&(Game.money+=this.reward,this.kill()),console.log("Health: "+this.health))},kill:function(a){void 0===a&&(a=!0),this.dead||(this.dead=!0,Game.enemyCount--,this.destroy(),Crafty.trigger("EnemyKilled",this),a&&Crafty.audio.play("EnemyDead",1))}})}.call(this),function(){Crafty.c("Grid",{init:function(){this.attr({w:Game.map_grid.tile.width,h:Game.map_grid.tile.height})},at:function(a,b){return void 0===a&&void 0===b?{x:this.x/Game.map_grid.tile.width,y:this.y/Game.map_grid.tile.height}:(this.attr({x:a*Game.map_grid.tile.width,y:b*Game.map_grid.tile.height}),this)}})}.call(this),function(){Crafty.c("HudElement",{init:function(){this.requires("2D, DOM, Grid, Text"),this.attr({x:0,y:0,w:Game.width()}),this.textFont(Game.hudFont),this.textColor(Game.textColor)},observe:function(a,b,c){return void 0===c&&(c=""),this.observable=b,this.bind("EnterFrame",function(){var a;a=void 0,a="function"==typeof this.observable?this.observable.call():Game[this.observable],this.oldValue!==a&&(this.trigger("ValueChanged",a),this.oldValue=a)}),this.bind("ValueChanged",function(b){this.text(a+": "+b+c)}),this},alertIfBelow:function(a){return this.bind("ValueChanged",function(b){b<a?this.textColor(Game.alertColor):this.textColor(Game.textColor)}),this},highlight:function(){return this.bind("ValueChanged",function(a){a>0?this.textColor(Game.highlightColor):this.textColor(Game.textColor)}),this}})}.call(this),function(){Crafty.c("LevelSelector",{init:function(){this.requires("DOMButton, TweenXY")},level:function(a){return this.text("Level "+a),this.addComponent("preview_level"+a),this.bind("Click",function(){Crafty.scene("InitializeLevel"+a)}),this}})}.call(this),function(){Crafty.c("Path",{init:function(){return this.requires("Actor, Image, Color"),this.image("assets/transparent.png").color("#969600",.42)}})}.call(this),function(){Crafty.c("PathWalker",{init:function(){},animate_along:function(a,b){var c,d,e;for(b||(b=1),c={actor:this,speed:b,steps:[]},d=0;d<a.length;)c.steps.push({x:a[d].x*Game.map_grid.tile.width,y:a[d].y*Game.map_grid.tile.height}),d++;return e=Crafty.e("TweeningHandler"),e.targets.push(c),this},animate_to:function(a,b,c){return this.animate_along([{x:a,y:b}],c)},destroy_after_animation:function(){var a;return a=this,Crafty.bind("TweenEnded",function(b){b===a&&a.destroy()}),this}})}.call(this),function(){Crafty.c("RestartButton",{init:function(){this.requires("DOMButton"),this.text("Start again?"),this.tooltip("Clicking this button starts another game"),this.attr({x:0,y:Game.height()-100,w:Game.width(),h:50}),this.textFont(Game.restartFont),this.textColor(Game.restartColor),this.bind("Click",function(){console.log("Restaaaaaart"),Crafty.isPaused()&&Crafty.pause(),Crafty.scene("Difficulty")})}})}.call(this),function(){Crafty.c("Sidebar",{init:function(){var a,b;this.requires("2D, DOM, Mouse,  Color"),this.attr({x:0,y:Game.map_grid.tile.height,w:170,h:Game.height()-2*Game.map_grid.tile.height,z:100}),this.color("#777777",.42),this.bind("MouseOver",function(a){a.preventDefault()}),b=this,a=Crafty.e("DOMButton").attr({x:b.w-27,y:this.y,w:25,h:25,z:101,tooltipWidth:50,tooltipHeight:75}).textFont(Game.closeFont).css(Game.closeCss).text("x").tooltip("Closes the sidebar").bind("Click",function(){b.close()}),this.upgradeHeadline=Crafty.e("2D, DOM, Text").attr({x:0,y:70,w:b.w,z:101}).textColor(Game.textColor).textFont(Game.sidebarFont),this.upgradeButton=Crafty.e("DOMButton").attr({x:0,y:160,w:b.w,h:40,z:101}).bind("Click",function(){b.selectedTower.upgrade()}),this.sellHeadline=Crafty.e("2D, DOM, Text").attr({x:0,y:260,w:b.w,z:101}).textColor(Game.textColor).textFont(Game.sidebarFont),this.sellButton=Crafty.e("DOMButton").attr({x:0,y:330,w:b.w,h:40,z:101}).bind("Click",function(){Crafty.e("TowerPlace").at(b.selectedTower.at().x,b.selectedTower.at().y),b.selectedTower.sell(),b.close()}),this.attach(a),this.attach(this.upgradeHeadline),this.attach(this.upgradeButton),this.attach(this.sellHeadline),this.attach(this.sellButton),this.close(),this.bind("TowerUpgraded",function(){b.updateTexts()})},highlightTower:function(){Crafty("Sidebar").selectedTower.color("#ffffff",.3)},openFor:function(a){this.selectedTower&&(this.selectedTower.unbind("MouseOut",this.highlightTower),this.selectedTower.color("#ffffff",0)),this.selectedTower=a,this.selectedTower.bind("MouseOut",this.highlightTower),this.selectedTower.x<Game.width()/2?this.x=Game.width()-this.w-Game.map_grid.tile.width:this.x=Game.map_grid.tile.width,this.updateTexts()},updateTexts:function(){var a;a=this.selectedTower.has("SniperTower")?"Sniper Tower":"Flower Tower",this.selectedTower.isUpgradable()?(this.upgradeHeadline.text("Upgrade "+a+" to level "+(this.selectedTower.level+1)+":"),this.upgradeButton.text("-"+this.selectedTower.getUpgradeCost()+"$").tooltip("Upgrade "+a+" at position ("+this.selectedTower.at().x+"/"+this.selectedTower.at().y+") to level "+(this.selectedTower.level+1)+" for "+this.selectedTower.getUpgradeCost()+"$")):(this.upgradeHeadline.text(a+": Maximum level reached"),this.upgradeButton.text("-").tooltip("Maximum level reached, can't upgrade tower")),this.sellHeadline.text("Sell "+a+":"),this.sellButton.text("+"+this.selectedTower.getSellValue()+"$").tooltip("Sell "+a+" at position ("+this.selectedTower.at().x+"/"+this.selectedTower.at().y+") to get back "+this.selectedTower.getSellValue()+"$")},close:function(){this.x=-this.w-50,this.selectedTower&&(this.selectedTower.unbind("MouseOut",this.highlightTower),this.selectedTower.color("#ffffff",0)),this.selectedTower=null}})}.call(this),function(){Crafty.c("SoundButton",{init:function(){this.requires("DOMButton"),Crafty.storage("muted")?(Crafty.audio.mute(),this.text("Sound: Off"),this.tooltip("Sound is off. Click to turn it on.")):(this.text("Sound: On"),this.tooltip("Sound is on. Click to turn it off.")),this.bind("Click",function(){Crafty.audio.muted?(Crafty.audio.unmute(),this.text("Sound: On"),this.tooltip("Sound is on. Click to turn it off."),Crafty.storage("muted",!1)):(Crafty.audio.mute(),this.text("Sound: Off"),this.tooltip("Sound is off. Click to turn it on."),Crafty.storage("muted",!0))})}})}.call(this),function(){Crafty.c("Tooltip",{init:function(){this.requires("Mouse"),this.tooltipText="Tooltip-Text here",this._tooltip=null,this.tooltipWidth=300,this.tooltipHeight=50,this.bind("MouseOver",this.createTooltip),this.bind("MouseOut",this.destroyTooltip)},createTooltip:function(){var a,b,c;b=Math.min(Game.width()-this.tooltipWidth-10,Math.max(0,this.x+(this.w-this.tooltipWidth)/2)),c=Math.max(0,this.y-this.tooltipHeight-10),this.y<this.h+this.tooltipHeight&&(c=this.y+this.h),this._tooltip=Crafty.e("2D, DOM, Mouse").attr({x:b,y:c,w:this.tooltipWidth,h:this.tooltipHeight,z:500}).css(Game.generalTooltipCss),a=Crafty.e("2D, DOM, Text").attr({x:b+2,y:c+2,w:this.tooltipWidth,h:this.tooltipHeight,z:520}).text(this.tooltipText).textFont(Game.generalTooltipFont).textColor(Game.textColor).css(Game.centerCss),this._tooltip.attach(a),this.attach(this._tooltip)},destroyTooltip:function(){this._tooltip.destroy()},tooltip:function(a){return this.tooltipText=a,this._tooltip&&this._tooltip._children.length>0&&this._tooltip._children[0].text(a),this}})}.call(this),function(){Crafty.c("Tree",{init:function(){return this.requires("Actor, Color"),this.color("rgb(20, 125, 40)")}})}.call(this),function(){Crafty.c("TweenXY",{init:function(){this.requires("2D")},moveTo:function(a,b,c){var d,e,f,g;return f=1e3/Crafty.timer.FPS(),e=Math.max(Math.abs(a-this.x),Math.abs(b-this.y))*f/c,d={actor:this,speed:e,steps:[{x:a,y:b}]},g=Crafty.e("TweeningHandler"),g.targets.push(d),this}})}.call(this),function(){Crafty.c("TweeningHandler",{init:function(){this.requires("Keyboard"),this.attr({targets:[],stepsPerGrid:25}),this.bind("EnterFrame",this.tweenHandler)},moveActor:function(a,b,c){var d,e;d=a.actor.x,e=a.actor.y,a.actor.x<a.steps[0].x?d=Math.min(a.actor.x+b,a.steps[0].x):a.actor.x>a.steps[0].x&&(d=Math.max(a.actor.x-b,a.steps[0].x)),a.actor.y<a.steps[0].y?e=Math.min(a.actor.y+c,a.steps[0].y):a.actor.y>a.steps[0].y&&(e=Math.max(a.actor.y-c,a.steps[0].y)),a.actor.attr({x:d,y:e})},triggerDirectionChanged:function(a){0!==a.steps.length&&(a.steps[0].x<a.actor.x?Crafty.trigger("TweenDirectionChanged",a.actor,"left"):a.steps[0].x>a.actor.x?Crafty.trigger("TweenDirectionChanged",a.actor,"right"):a.steps[0].y<a.actor.y?Crafty.trigger("TweenDirectionChanged",a.actor,"up"):a.steps[0].y>a.actor.y&&Crafty.trigger("TweenDirectionChanged",a.actor,"down"))},tweenHandler:function(){var a,b,c,d;if(!Crafty.isPaused())for(d=0;d<this.targets.length;)a=this.targets[d],b=a.speed*Game.map_grid.tile.width/this.stepsPerGrid,c=a.speed*Game.map_grid.tile.height/this.stepsPerGrid,a.actor.x!==a.steps[0].x||a.actor.y!==a.steps[0].y?this.moveActor(a,b,c):(a.steps.shift(),this.triggerDirectionChanged(a)),0===a.steps.length&&(this.targets.splice(d,1),d--,Crafty.trigger("TweenEnded",a.actor)),d++}})}.call(this),function(){Crafty.c("Wave",{init:function(){this.requires("DOMButton, Grid, Delay"),this.attr({w:150,tooltipWidth:350,clickEnabled:!0}),this.text("Start"),this.tooltip("Starts the next wave of enemies. Click here once you placed your towers."),this.textFont(Game.waveFont),this.currentWave=Game.currentWave,this.blinkBeforeStart(),this.automaticallyStartNextWave(),this.startNextWaveOnClick()},blinkBeforeStart:function(){var a;a=!1,this.delay(function(){this.waveStarted||(a?this.textColor(Game.textColor):this.textColor(Game.highlightColor),a=!a)},1e3,-1)},automaticallyStartNextWave:function(){this.bind("EnterFrame",function(){var a,b;this.isWaveFinished()&&(this.finishedEventTriggered||(Crafty.trigger("WaveFinished",this.currentWave),this.finishedEventTriggered=!0,a=Crafty("FlowerTower"),b=0,a.length>0&&this.delay(function(){a.get(b).shoot(),b++},500,a.length-1)),this.isNextWavePossible()&&(Game.money+=Game.moneyAfterWave,this.startNextWave(),console.log("Started wave "+this.currentWave),this.finishedEventTriggered=!1))})},startNextWaveOnClick:function(){this.bind("Click",function(){this.clickEnabled&&(this.clickEnabled=!1,this.text("Next Wave"),this.textColor(Game.disabledColor),this.tooltip("Button currently disabled."),this.currentWave>0&&(Game.money+=Game.moneyAfterWave),this.startNextWave(),this.delay(function(){this.clickEnabled=!0,this.textColor(Game.textColor),this.tooltip("Start next wave early to get wave finished bonus gold.")},1e4,0))})},isWaveFinished:function(){return 0===Game.enemyCount&&this.spawnFinished},isNextWavePossible:function(){return 0!==Game.lifes&&(Game.endless||this.currentWave<Game.waves.current.length)},startNextWave:function(){var a,b,c;this.spawnFinished=!1,this.waveStarted=!0,b=0,a=this.getEnemies(),c=3e3,this.currentWave>Game.waves.current.length&&(c=Math.max(200,3e3-50*(this.currentWave-Game.waves.current.length))),this.delay(function(){var c,d;d=Crafty.e(a[b]).at(Game.path.start.x,Game.path.start.y),this.delay(function(){d.animate_along(Game.path.getPath(),d.speed)},500,0),this.currentWave>Game.waves.current.length&&(c=this.currentWave-Game.waves.current.length,d.attr({health:Math.floor((1+.05*c)*d.health+5*c)}),console.log("new health: "+d.health)),++b===a.length&&(this.spawnFinished=!0,console.log("spawn finished"))},c,a.length-1),this.currentWave===Game.waves.current.length-1&&(Crafty.audio.stop(),Crafty.audio.play("Boss",-1)),this.currentWave++,Game.currentWave=this.currentWave},getEnemies:function(){var a,b;if(this.currentWave<Game.waves.current.length)return Game.waves.current[this.currentWave];for(a=["GreenDragon","Orc"],b=0;b<this.currentWave-Game.waves.current.length;)a.push(b%10==4?"SilverDragon":b%6==2?"GreenDragon":b%4==0?"MightyWitch":b%4==2?"FastKnight":"FastSquid"),b++;return a.push("GreenDragon"),a}})}.call(this),function(){Crafty.c("FastKnight",{init:function(){this.requires("Enemy, knight_right"),this.attr({health:65,reward:15,speed:2.7,tooltipWidth:200,tooltipTextBase:"Fast Knight"})}})}.call(this),function(){Crafty.c("FastSquid",{init:function(){this.requires("Enemy, squid"),this.attr({health:23,reward:5,speed:2.5,tooltipWidth:200,tooltipTextBase:"Fast Squid"})}})}.call(this),function(){Crafty.c("GreenDragon",{init:function(){this.requires("Enemy, green_dragon"),this.attr({health:200,reward:50,speed:1.5,livesTaken:3,noInstantKill:!0,tooltipHeight:60,tooltipTextBase:"Green Dragon"})}})}.call(this),function(){Crafty.c("Knight",{init:function(){this.requires("Enemy, knight_right"),this.attr({health:50,reward:10,speed:1.3,tooltipWidth:200,tooltipTextBase:"Knight"})}})}.call(this),function(){Crafty.c("MightyWitch",{init:function(){this.requires("Enemy, witch_down, Delay"),this.attr({health:100,reward:20,speed:1.8,tooltipWidth:200,tooltipHeight:60,tooltipTextBase:"Mighty Witch (disables towers)"}),this.delay(function(){var a,b;b=Crafty("Tower Enabled"),b.length>0&&(a=b.get(Math.floor(Math.random()*b.length)),a.disable())},5e3,-1)}})}.call(this),function(){Crafty.c("Orc",{init:function(){this.requires("Enemy, orc"),this.attr({health:200,reward:30,speed:.8,livesTaken:2,tooltipTextBase:"Orc"})}})}.call(this),function(){Crafty.c("SilverDragon",{init:function(){this.requires("Enemy, silver_dragon"),this.attr({health:800,reward:150,speed:1.8,livesTaken:7,noInstantKill:!0,tooltipHeight:60,tooltipTextBase:"Silver Dragon"})}})}.call(this),function(){Crafty.c("Spider",{init:function(){this.requires("Enemy, spider"),this.attr({health:60,reward:5,speed:1.7,tooltipTextBase:"Spider"})}})}.call(this),function(){Crafty.c("Squid",{init:function(){this.requires("Enemy, squid"),this.attr({health:30,reward:3,speed:1,tooltipTextBase:"Squid"})}})}.call(this),function(){Crafty.c("Witch",{init:function(){this.requires("Enemy, witch_right"),this.attr({health:5,reward:1,speed:1.8,tooltipTextBase:"Witch"})}})}.call(this),function(){Crafty.scene("Credits",function(a){Crafty.e("2D, DOM, Text").text("Programming:").textFont(Game.creditsFont).textColor(Game.highlightColor).css(Game.centerCss).attr({x:0,y:30,w:Game.width(),h:50}),Crafty.e("2D, DOM, Text").text('Game-Framework is Crafty (<a target="_blank" href="http://craftyjs.com">http://craftyjs.com</a>)<br>Programming is done by me (<a target="_blank" href="http://www.github.com/olilo/flower-tower-defense/">http://www.github.com/olilo/flower-tower-defense/</a>)').textFont(Game.creditsTextFont).textColor(Game.textColor).css(Game.centerCss).attr({x:0,y:70,w:Game.width(),h:100}),Crafty.e("2D, DOM, Text").text("Graphics:").textFont(Game.creditsFont).textColor(Game.highlightColor).css(Game.centerCss).attr({x:0,y:140,w:Game.width(),h:50}),Crafty.e("2D, DOM, Text").text('roguelikebosses (orc, dragons, spider) by @JoeCreates<br>Witch graphic by Heather Harvey - cind_rella@hotmail.com<br>Generally: art from <a href="http://opengameart.org">http://opengameart.org</a><br>Knight and flowers by me ^^ (license-free)').textFont(Game.creditsTextFont).textColor(Game.textColor).css(Game.centerCss).attr({x:0,y:180,w:Game.width(),h:120}),Crafty.e("2D, DOM, Text").text("Music:").textFont(Game.creditsFont).textColor(Game.highlightColor).css(Game.centerCss).attr({x:0,y:300,w:Game.width(),h:50}),Crafty.e("2D, DOM, Text").text('Title-Song and Won-Song generated by Music Maker Jam<br>Game-Music by <a target="_blank" href="http://opengameart.org/users/tkz-productions">WakianTech</a>').textFont(Game.creditsTextFont).textColor(Game.textColor).css(Game.centerCss).attr({x:0,y:340,w:Game.width(),h:100}),a.text?Crafty.e("DOMButton").text(a.text).attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("Continue to next screen").bind("Click",function(){Crafty.scene(a.scene)}):Crafty.e("DOMButton").text("Back").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("Go back to where you came from").bind("Click",function(){Crafty.scene(a)}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50,blablubb:10})})}.call(this),function(){Crafty.scene("Difficulty",function(){var a;Crafty.background("rgb(169, 153, 145)"),Crafty.audio.stop(),Crafty.audio.play("Menu",-1),Crafty.e("2D, DOM, Image").image("assets/ftd-logo.jpg").attr({x:80,y:1*Game.height()/12-24,w:Game.width(),h:200}),Crafty.e("2D, DOM, Text").text("Choose your difficulty:").attr({x:0,y:3*Game.height()/6-24,w:Game.width(),h:50}).textFont(Game.difficultyFont).textColor(Game.textColor).css(Game.centerCss);for(a in Game.difficulties)Game.difficulties.hasOwnProperty(a)&&Crafty.e("DOMButton").text(a).tooltip(Game.difficulties[a].tooltip).attr({x:Game.difficulties[a].x*Game.width()/2,y:(2*Game.difficulties[a].y+7)/12*Game.height(),w:Game.width()/2,h:50}).textFont(Game.difficultyFont).textColor(Game.difficulties[a].textColor).bind("Click",function(){console.log("Chosen difficulty: "+this.text()),Game.setDifficultyProperties(this.text()),Crafty.scene("MapSelection")});return Crafty.e("DOMButton").text("Instructions").attr({x:70,y:Game.height()-50,w:200,h:50}).tooltip("Click here for some instructions").bind("Click",function(){Crafty.scene("Help","Difficulty")}),Crafty.e("DOMButton").text("Credits").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("View the credits for this game ^^").bind("Click",function(){Crafty.scene("Credits","Difficulty")}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50})})}.call(this),function(){Crafty.scene("Game",function(){var a,b,c;for(Crafty.e("2D, Canvas, "+Game.backgroundAsset),Crafty.audio.stop(),Crafty.audio.play("Background",-1),Crafty.e("HudElement").observe("Money","money","$").at(1),Crafty.e("HudElement").observe("Lifes","lifes").at(6).alertIfBelow(3),Crafty.e("HudElement").observe("Enemies","enemyCount").at(10),Crafty.e("HudElement").observe("Wave","currentWave").at(14),Crafty.e("HudElement").observe("FPS",Game.actualFPS.FPS).at(18),Crafty.e("DOMButton, Grid").text("Restart level").tooltip("Restart this level with difficulty "+Game.difficulty+" at wave 1").textColor(Game.highlightColor).textFont(Game.hudFont).unbind("Click").bind("Click",function(){window.confirm("Really restart this level? You will restart at wave 1 with no towers!")&&(console.log("Restarting level "+Game.level),Crafty.isPaused()&&Crafty.pause(),Game.setDifficultyProperties(Game.difficulty),Crafty.scene("InitializeLevel"+Game.level))}).at(20,0).attr({w:180}),Crafty.e("TowerSelector").forTower("FlowerTower").attr({tooltipWidth:500,tooltipHeight:130}).tooltip("Click here to select the Flower Tower.<br> If you click anywhere on the map you build this tower.<br>It shoots in all 4 directions with limited range.<br> Gains higher range on upgrade.<br> Hotkey: C").withSprite("flower_tower5").withHotkey("C").at(1,Game.map_grid.height-1),Crafty.e("TowerSelector").forTower("SniperTower").attr({tooltipWidth:500,tooltipHeight:130}).tooltip("Click here to select the Sniper Tower.<br> If you click anywhere on the map you build this tower.<br> It shoots anywhere on the map, but cost increases.<br> Gains instant kill on highest level.<br> Hotkey: V").withSprite("sniper_tower4").withHotkey("V").at(3,Game.map_grid.height-1),Crafty.bind("EnterFrame",function(){Game.lifes<=0&&(Crafty.unbind("EnterFrame"),Crafty.scene("GameOver"))}),Crafty.bind("WaveFinished",function(a){Crafty.storage("ftd_save1",Game),Game.lifes>0&&a===Game.waves.current.length&&(Crafty.unbind("EnterFrame"),Crafty.scene("Won"))}),Crafty.bind("TowerCreated",function(a){var b,c;for(c=["FlowerTower","SniperTower"],b=0;b<c.length;){if(a.has(c[b]))return Game.towerMap[a.at().x][a.at().y].name=c[b],void(Game.towerMap[a.at().x][a.at().y].level=1);b++}}),Crafty.bind("TowerUpgraded",function(a){Game.towerMap[a.at().x][a.at().y].level=a.level}),Game.towers.SniperTower=Game.sniperTowerInitial,b=0;b<Game.map_grid.width;){for(c=0;c<Game.map_grid.height;)Game.path.isOnEdge(b,c)?Crafty.e("Tree").at(b,c):Game.path.isOnPath(b,c)?Crafty.e("Path").at(b,c):Game.towerMap[b][c].level>0?Crafty.e(Game.towerMap[b][c].name).at(b,c).attr({level:Game.towerMap[b][c].level}).updateTooltip():Crafty.e("TowerPlace").at(b,c),c++;b++}return Crafty.e("Wave").at(Game.map_grid.width-5,Game.map_grid.height-1),Crafty.e("Sidebar"),Crafty.e("DOMButton, Grid").text("Help").textFont(Game.waveFont).at(8,Game.map_grid.height-1).attr({w:100}).tooltip("If you are lost, look here").bind("Click",function(){var a;return a=document.getElementById("helpOverlay"),a?a.parentNode.removeChild(a):(a=document.createElement("div"),a.setAttribute("id","helpOverlay"),a.style.position="absolute",a.style.width=Game.width()-40+"px",a.style.padding="10px",a.style.left="10px",a.style.top="30px",a.style.border="1px solid black",a.style.background="grey",a.style.zIndex="1000",a.innerHTML='<p>Click anywhere to build the selected tower type. You can find the selected tower type in the lower left of the screen (black is selected).</p><p>When you click on an already built tower you upgrade that tower. The costs and the current tower level are displayed on mouse over in the top right of the screen (Cost and Level).</p><p><em><strong>There are two tower types to choose from, with the first one automatically selected:</strong></em></p><p>The first tower type shoots leafs into all 4 directions, which damage the enemy on impact. They have a limited range so build these towers near the path. Their range increases on higher levels.</p><p>The second tower shoots all over the map at a single random target.The first tower you build of this type is relatively cheap, but each one after the first one gets more and more expensive. Upgrading, however, always costs the same.<br>This tower gains a 2% chance to instantly kill an enemy on its highest level.</p><p>You have to start the first wave by clicking "Start". After that the waves come automatically, but you can start the next wave earlier by clicking "Next Wave" again.</p><p>You win if you finish all 15 waves. You can challenge yourself and see how far you can get in endless mode after that.</p>',document.getElementById("cr-stage").appendChild(a))}),a=document.createElement("div"),a.style.border="1px solid black",a.style.backgroundColor="grey",a.style.display="none",a.style.position="absolute",a.style.padding="10px",a.style.left="350px",a.style.top="200px",a.style.font='bold 36px "sans-serif"',a.style.color="white",a.style.zIndex="900",a.innerHTML="Paused",document.getElementById("cr-stage").appendChild(a),Crafty.e("DOMButton, Grid, Keyboard, Delay").text("Pause").textFont(Game.waveFont).at(11,Game.map_grid.height-1).attr({w:100,h:50}).tooltip("Pause or unpause the game (Hotkey: P)").bind("Click",function(){return Crafty.pause(),Crafty.isPaused()?a.style.display="block":a.style.display="none"}).bind("KeyDown",function(){this.isDown("P")&&(Crafty.pause(),Crafty.isPaused()?a.style.display="block":a.style.display="none")}),Crafty.e("SoundButton, Grid").textFont(Game.waveFont).attr({w:150,h:50}).at(15,Game.map_grid.height-1)})}.call(this),function(){Crafty.scene("GameOver",function(){return Crafty.background("rgb(169, 153, 145)"),Crafty.audio.stop(),Crafty.audio.play("Menu",-1),Crafty.e("2D, DOM, Image").image("assets/ftd-logo.jpg").attr({x:80,y:1*Game.height()/12-24,w:Game.width(),h:200}),Crafty.e("2D, DOM, Text").text("Game over").attr({x:0,y:3*Game.height()/5-24,w:Game.width()}).textFont(Game.gameOverFont).textColor(Game.gameOverColor).css(Game.centerCss),Crafty.e("RestartButton")})}.call(this),function(){Crafty.scene("Help",function(a){return Crafty.e("2D, DOM, Text").attr({x:10,y:10,w:Game.width()-20,h:Game.height()}).text('<p>Choose a difficulty and select a map. The game starts. You can click anywhere to build the selected tower type. You can find the selected tower type in the lower left of the screen (black is selected).</p><p>When you click on an already built tower you upgrade that tower. The costs and the current tower level are displayed on mouse over in the top right of the screen (Cost and Level).</p><p><em><strong>There are two tower types to choose from, with the first one automatically selected:</strong></em></p><p>The first tower type shoots leafs into all 4 directions, which damage the enemy on impact.They have a limited range so build these towers near the path. Their range increases on higher levels.</p><p>The second tower shoots all over the map at a single random target.The first tower you build of this type is relatively cheap,but each one after the first one gets more and more expensive.Upgrading, however, always costs the same.<br>This tower gains a 2% chance to instantly kill an enemy on its highest level.</p><p>You have to start the first wave by clicking "Start". After that the waves come automatically, but you can start the next wave earlier by clicking "Next Wave" again.</p><p>You win if you finish all 15 waves, but you can challenge yourself and see how far you can get in endless mode after that.</p>').textColor(Game.textColor).textFont(Game.explanationFont),Crafty.e("DOMButton").text("Back").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("Go back to where you came from").bind("Click",function(){Crafty.scene(a)}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50})})}.call(this),function(){Crafty.scene("InitializeLevel1",function(){var a;a=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss),Game.level="1",Game.backgroundAsset="background1",Game.waves.current=Game.waves.level1,Game.setGeneralProperties(),a.delay(function(){Game.path=new Path(Game.map_grid),Game.path.generateSpiral(),Crafty.scene("Game")},400)}),Crafty.scene("InitializeLevel2",function(){var a;a=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss),Game.level="2",Game.backgroundAsset="background2",Game.waves.current=Game.waves.level2,Game.setGeneralProperties(),a.delay(function(){Game.path=new Path(Game.map_grid),Game.path.generatePath(),Crafty.scene("Game")},400)}),Crafty.scene("InitializeLevel3",function(){var a;a=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss),Game.level="3",Game.backgroundAsset="background6",Game.waves.current=Game.waves.level3,Game.setGeneralProperties(),a.delay(function(){Game.path=new Path(Game.map_grid),Game.path.generateStartOnRow(0),Game.path.finish={x:14,y:Game.map_grid.height-1},Game.path.generatePath(),Crafty.scene("Game")},400)}),Crafty.scene("InitializeLevel4",function(){var a;a=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss),Game.level="4",Game.backgroundAsset="background5",Game.waves.current=Game.waves.level4,Game.setGeneralProperties(),a.delay(function(){var a;a={width:Game.map_grid.width,height:Game.map_grid.height,tile:Game.map_grid.tile,pathMinLength:5,pathMaxLength:20},Game.path=new Path(a),Game.path.start={x:9,y:0},Game.path.finish={x:14,y:Game.map_grid.height-1},Game.path.generatePath(),Crafty.scene("Game")},400)}),Crafty.scene("InitializeLevel5",function(){var a;a=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss),Game.level="5",Game.backgroundAsset="background9",Game.waves.current=Game.waves.level5,Game.setGeneralProperties(),a.delay(function(){Game.path=new Path(Game.map_grid),Game.path.pathMaxLength=110,Game.path.generateStartOnRow(0),Game.path.generateFinishInColumn(0),Game.path.generateLabyrinth(),Crafty.scene("Game")},400)})}.call(this),function(){Crafty.scene("Loading",function(){var a,b;a=Crafty.e("2D, Grid, DOM, Text, Delay").text("Loading...").attr({w:Game.width()}).at(0,5).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss),Crafty.e("Actor, Progress, Text").at(Game.map_grid.width/2-2,8).textFont(Game.loadingFont).textColor(Game.textColor).text("0%"),b=3,Crafty.load(Game.preLoadAssets,function(){a.delay(function(){b>=22&&(Crafty("flower Loading").destroy(),b=3),Crafty.e("2D, DOM, Grid, flower, Loading").at(b,10),b+=2},500,-1)}),Crafty.load(Game.assets,function(){Game.endless=!1,Crafty.scene("MainMenu")},function(a){Crafty("Progress").text(Math.floor(a.percent)+"%")})})}.call(this),function(){Crafty.scene("MainMenu",function(){var a,b;Crafty.background("rgb(169, 153, 145)"),Crafty.audio.stop(),Crafty.audio.play("Menu",-1),Crafty.e("2D, DOM, Image").image("assets/ftd-logo.jpg").attr({x:80,y:1*Game.height()/12-24,w:Game.width(),h:200}),b=Crafty.storage("ftd_save1"),a=Crafty.e("DOMButton").text("Load Saved game").attr({x:0,y:7*Game.height()/12-24,w:Game.width(),h:50,tooltipWidth:350}),b?a.tooltip("Continue the game you played last time with difficulty "+b.difficulty+" on wave "+b.currentWave).bind("Click",function(){Game.difficulty=b.difficulty||"Normal",Game.money=b.money,Game.lifes=b.lifes,Game.moneyAfterWave=b.moneyAfterWave,Game.towers=b.towers,Game.level=b.level||"2",Game.backgroundAsset=b.backgroundAsset||"background1",Game.waves.current=b.waves.current||Game.waves.level2,Game.endless=b.currentWave>=Game.waves.current.length,Game.enemyCount=b.enemyCount,Game.currentWave=b.currentWave,Game.selectedTower=b.selectedTower,Game.sniperTowerInitial=b.sniperTowerInitial,Game.towerMap=b.towerMap,Game.path=new Path(Game.map_grid),Game.path.copy(b.path),Crafty.scene("Game")}):a.tooltip("No savegame exists yet.").disable(),Crafty.e("DOMButton").text("Start new game").attr({x:0,y:9*Game.height()/12-24,w:Game.width(),h:50}).tooltip("Starts a new game. You can select the difficulty on the next screen.").bind("Click",function(){Crafty.storage("ftd_save1")&&!confirm("Starting a new game will overwrite your already saved game. Continue?")||Crafty.scene("Difficulty")}),Crafty.e("DOMButton").text("Instructions").attr({x:70,y:Game.height()-50,w:200,h:50}).tooltip("Click here for some instructions").bind("Click",function(){Crafty.scene("Help","MainMenu")}),Crafty.e("DOMButton").text("Credits").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("View the credits for this game ^^").bind("Click",function(){Crafty.scene("Credits","MainMenu")}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50})})}.call(this),function(){Crafty.scene("MapSelection",function(){var a;return Crafty.background("rgb(119, 123, 125)"),Crafty.audio.stop(),Crafty.audio.play("Menu",-1),a=1,Crafty.e("2D, DOM, Image").image("assets/ftd-logo.jpg").attr({x:80,y:1*Game.height()/12-24,w:Game.width(),h:200}),Crafty.e("2D, DOM, Text").text("Choose a map:").attr({x:0,y:3*Game.height()/6-24,w:Game.width(),h:50}).textFont(Game.mapSelectionFont).textColor(Game.textColor).css(Game.centerCss),Crafty.e("DOMButton, Delay, Previous").text("Prev").attr({x:1*Game.width()/24,y:8*Game.height()/12-24,w:2*Game.width()/24,h:32}).tooltip("Show previous page of levels").disable().bind("Click",function(){this.buttonEnabled&&(a--,this.disable(),this.delay(function(){a>1&&this.enable(),Crafty("DOMButton Next").enable()},1e3),Crafty("LevelSelector").each(function(){this.moveTo(this.x+Game.width(),this.y,800)}))}),Crafty.e("DOMButton, Delay, Next").text("Next").attr({x:21*Game.width()/24,y:8*Game.height()/12-24,w:2*Game.width()/24,h:32}).tooltip("Show next page of levels").bind("Click",function(){this.buttonEnabled&&(a++,this.disable(),this.delay(function(){a<Crafty("Level").length/3&&this.enable(),console.log(Crafty("Level").length),Crafty("DOMButton Previous").enable()},1e3),Crafty("LevelSelector").each(function(){this.moveTo(this.x-Game.width(),this.y,800)}))}),Crafty.e("LevelSelector").level("1").tooltip("10 Waves of enemies who travel through a large spiral.").attr({x:4*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("LevelSelector").level("2").tooltip("15 Waves of enemies who travel from left to right.").attr({x:10*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("LevelSelector").level("3").tooltip("15 Waves of enemies who go from top to bottom.").attr({x:16*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("LevelSelector").level("4").tooltip("20 Waves in a fast-paced short path.").attr({x:28*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("LevelSelector").level("5").tooltip("15 Waves who travel through a maze.").attr({x:34*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("DOMButton").text("Instructions").attr({x:70,y:Game.height()-50,w:200,h:50}).tooltip("Click here for some instructions").bind("Click",function(){Crafty.scene("Help","MapSelection")}),Crafty.e("DOMButton").text("Credits").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("View the credits for this game ^^").bind("Click",function(){Crafty.scene("Credits","MapSelection")}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50})})}.call(this),function(){Crafty.scene("Won",function(){return Crafty.background(Game.wonColor),Crafty.audio.stop(),Crafty.audio.play("Won",-1),Crafty.e("2D, DOM, Image").image("assets/ftd-logo.jpg").attr({x:80,y:1*Game.height()/12-24,w:Game.width(),h:200}),Crafty.e("2D, DOM, Text").text("You Won :)").attr({x:0,y:7*Game.height()/12-24,w:Game.width(),h:50}).textFont(Game.wonFont).textColor(Game.textColor).css(Game.centerCss),Crafty.e("DOMButton").text("Continue in endless mode?").tooltip("Click here to continue your last game from wave "+Game.waves.current.length).attr({x:0,y:9*Game.height()/12-24,w:Game.width(),h:50}).textFont(Game.continueFont).textColor(Game.continueColor).bind("Click",function(){Game.endless=!0,Crafty.scene("Game")}),Crafty.e("RestartButton").attr({x:0,y:11*Game.height()/12-24,w:Game.width(),h:50})})}.call(this),function(){Crafty.c("Disabled",{init:function(){this.requires("Color, Mouse, Delay"),this.color("#ff0000",.5),this.bind("MouseOut",function(){this.color("#ff0000",.5)}),this.delay(function(){this.removeComponent("Disabled"),this.addComponent("Enabled")},2e4,0)}})}.call(this),function(){Crafty.c("Enabled",{init:function(){this.requires("Color, Mouse"),this.color("#ffffff",0),this.bind("MouseOver",function(){this.color("#6666b6",.2)}),this.bind("MouseOut",function(){this.color("#ffffff",0)})},disable:function(){this.removeComponent("Enabled"),this.addComponent("Disabled")}})}.call(this),function(){Crafty.c("FlowerTower",{init:function(){var a,b;this.requires("Tower, flower_tower1"),this.range=4,this.maxLevel=10,this.shootingSpeed=.4,this.bind("TowerUpgraded",function(a){a===this&&this.handleLevelup()}),this.delay(function(){this.handleLevelup()},100,0),b=0,a=!0,this.delay(function(){b++%4==0&&(a=this.isEnemyNear()),this.has("Enabled")&&a&&this.shoot()},1e3*this.shootingSpeed,-1)},handleLevelup:function(){var a;for(this.level===this.maxLevel?this.range=6:this.level>=4?this.range=5:this.range=4,a=1;a<Math.ceil(this.level/2);)this.removeComponent("flower_tower"+a),a++;this.addComponent("flower_tower"+Math.ceil(this.level/2)),this.updateTooltip()},updateTooltip:function(){this.tooltip("Flower Tower at level "+this.level+", <br>"+this.getDamage()+" damage per petal, <br>"+this.getDamage()/this.shootingSpeed+" dps in a square of "+this.range+" tiles <br>"+this.getUpgradeText())},shoot:function(){var a,b,c,d,e,f;e=this.at().x,f=this.at().y,d=void 0,c=void 0,a=void 0,b=void 0,Game.options.bulletImages?(d=Crafty.e("Bullet, leaf_up"),c=Crafty.e("Bullet, leaf_right"),a=Crafty.e("Bullet, leaf_down"),b=Crafty.e("Bullet, leaf_left")):(d=Crafty.e("Bullet").attr({w:16,h:16}),c=Crafty.e("Bullet").attr({w:16,h:16}),a=Crafty.e("Bullet").attr({w:16,h:16}),b=Crafty.e("Bullet").attr({w:16,h:16})),d.attr({damage:this.getDamage()}).at(e,f).animate_to(e,f-this.range,4).destroy_after_animation(),c.attr({damage:this.getDamage()}).at(e,f).animate_to(e+this.range,f,4).destroy_after_animation(),a.attr({damage:this.getDamage()}).at(e,f).animate_to(e,f+this.range,4).destroy_after_animation(),b.attr({damage:this.getDamage()}).at(e,f).animate_to(e-this.range,f,4).destroy_after_animation()},isEnemyNear:function(){var a,b,c,d,e;return b=this.at().x-this.range-2,c=this.at().x+this.range+2,d=this.at().y-this.range-2,e=this.at().y+this.range+2,a=!1,Crafty("Enemy").each(function(){var f;f=this.at(),f.x>=b&&f.x<=c&&f.y>=d&&f.y<=e&&(a=!0)}),a},getDamage:function(){return this.level<6?this.level:Math.floor(Math.sqrt(this.level-5)*this.level)},getUpgradeCost:function(a){return void 0===a&&(a=this.level),Math.floor(Game.towers.FlowerTower*Math.pow(1.4,a))}})}.call(this),function(){Crafty.c("SniperTower",{init:function(){this.requires("Tower, SpriteAnimation, sniper_tower1"),this.attr({w:32,h:32}),this.maxLevel=6,this.bind("TowerUpgraded",function(a){a===this&&this.handleLevelup()}),this.bind("TowerSold",function(a){a===this&&(Game.towers.SniperTower=Math.floor(Game.towers.SniperTower/1.25))}),this.delay(function(){Game.towers.SniperTower=Math.floor(1.25*Game.towers.SniperTower),this.handleLevelup()},100,0),this.delay(function(){Game.enemyCount>0&&this.has("Enabled")&&this.shoot()},4e3,-1)},handleLevelup:function(){var a;for(a=1;a<Math.ceil((this.level+1)/2);)this.removeComponent("sniper_tower"+a),a++;this.addComponent("sniper_tower"+Math.ceil((this.level+1)/2)),this.updateTooltip()},updateTooltip:function(){this.tooltip("Sniper Tower at level "+this.level+", <br>"+this.getDamage()+" damage per petal, <br>"+this.getDamage()/4+" dps on the whole map <br> "+this.getUpgradeText())},shoot:function(){var a,b,c,d,e;a=Crafty("Enemy").get(0),this.level!==this.maxLevel||0!==Math.floor(50*Math.random())||a.noInstantKill?(this.delay(function(){a.hitWithDamage(this.getDamage())},500,0),b=this.at().x,d=this.at().y,c=Math.floor(a.at().x),e=Math.floor(a.at().y),Game.options.bulletImages&&Crafty.e("Bullet, leaf_right").attr({damage:0}).at(b,d).animate_to(c,e,35).destroy_after_animation()):(console.log("INSTANT KILL!!"),a.kill())},getDamage:function(){return 5*this.level},getUpgradeCost:function(a){return void 0===a&&(a=this.level),Math.floor(1.5*Game.towers.SniperTowerUpgrade*Math.sqrt(a))}})}.call(this),function(){Crafty.c("Tower",{init:function(){this.requires("Actor, Mouse, Tooltip, Color, Delay, Enabled"),this.attr({level:1,tooltipWidth:250,tooltipHeight:110}),Crafty.mobile?this.bind("MouseUp",function(){this.previousMouseUp?this.upgrade():this.previousMouseUp=!0}):this.bind("Click",function(){Crafty("Sidebar").selectedTower===this?this.upgrade():Crafty("Sidebar").openFor(this)})},isUpgradable:function(){return this.level<this.maxLevel},upgrade:function(){var a;a=this.getUpgradeCost(),this.isUpgradable()?(Game.money>=a&&(this.level++,Game.money-=a,Game.towerCost=this.getUpgradeCost(),Game.towerLevel=this.level,Crafty.trigger("TowerUpgraded",this)),console.log("Upgraded tower ("+this.at().x+"/"+this.at().y+") for "+a)):console.log("Tower ("+this.at().x+"/"+this.at().y+") at max level, can't upgrade it")},getUpgradeText:function(){return this.isUpgradable()?"(Upgrade costs "+this.getUpgradeCost()+"$) <br>":"(maximum level reached)"},sell:function(){Game.money+=this.getSellValue(),Crafty.trigger("TowerSold",this),this.destroy(),console.log("Sold tower for "+this.getSellValue()+"$")},getSellValue:function(){var a,b,c;for(c=0,a=1;a<=this.level;)b=this.getUpgradeCost(a),"MAX"!==b&&(c+=b),a++;return Math.floor(.5*c)}})}.call(this),function(){Crafty.c("TowerPlace",{init:function(){this.requires("Actor, Delay, Mouse, Image, Color, Tooltip"),this.image("assets/transparent.png").color("#ffffff",0),this.bind("MouseOver",function(){this.color("#b66666",.2)}),this.bind("MouseOut",function(){this.color("#ffffff",0),this.previousMouseUp=!1}),Crafty.mobile&&this.bind("MouseUp",function(a){this.previousMouseUp?this.trigger("Click",a):this.previousMouseUp=!0}),this.tooltip("Build a new "+Game.selectedTower+" here for "+Game.towers[Game.selectedTower]+" gold"),this.bind("TowerCreated",function(){this.delay(function(){this.tooltip("Build a new "+Game.selectedTower+" here for "+Game.towers[Game.selectedTower]+" gold")},500,0)}),this.bind("TowerChanged",function(){this.tooltip("Build a new "+Game.selectedTower+" here for "+Game.towers[Game.selectedTower]+" gold")}),this.bind("Click",function(){var a;Game.money>=Game.towers[Game.selectedTower]&&(a=Crafty.e(Game.selectedTower).at(this.at().x,this.at().y),Game.money-=Game.towers[Game.selectedTower],Game.towerLevel=1,Crafty.trigger("TowerCreated",a),Crafty("Sidebar").openFor(a),this.destroy())})}})}.call(this),function(){Crafty.c("TowerSelector",{init:function(){this.requires("DOMButton, Grid, Keyboard"),this.attr({x:0,y:Game.height()-Game.map_grid.tile.height,z:100}),this.textFont(Game.towerSelectorFont)},forTower:function(a){return this.targetTower=a,this.bind("EnterFrame",function(){this.oldValue!==Game.towers[a]&&this.text(Game.towers[a])}),this.bind("TowerCreated",function(){this.text(Game.towers[a])}),Game.selectedTower===this.targetTower?this.textColor(Game.highlightColor):this.textColor(Game.textColor),this.bind("TowerChanged",function(){Game.selectedTower===this.targetTower?this.textColor(Game.highlightColor):this.textColor(Game.textColor)}),this.bind("Click",function(){Game.selectedTower=a,Crafty.trigger("TowerChanged")}),this},withHotkey:function(a){return this.bind("KeyDown",function(){this.isDown(a)&&(Game.selectedTower=this.targetTower,Crafty.trigger("TowerChanged"))}),this}})}.call(this);